{% load static %}
{% include 'lolapp/header.html' %}
<link rel="stylesheet" href="{% static 'header.css' %}">
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Í≤ΩÍ∏∞Í∏∞Î°ù</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { 
            background: #23232b; 
            font-family: 'Segoe UI', Arial, sans-serif; 
            color: #e0e0e0; 
            margin: 0;
        }
        .container { 
            max-width: 1400px; 
            margin: 40px auto; 
            background: #23232b; 
            border-radius: 10px; 
            padding: 24px; 
        }
        .section-title { 
            font-size: 1.2em; 
            margin: 0 0 20px 0; 
            color: #90caf9; 
            text-align: center;
            font-weight: bold;
        }
        
        /* ÌïÑÌÑ∞ ÏÑπÏÖò */
        .filter-section {
            background: #32323e;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px #0002;
        }
        .filter-row {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }
        .filter-row:last-child {
            margin-bottom: 0;
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .filter-label {
            color: #90caf9;
            font-weight: bold;
            min-width: 60px;
            font-size: 0.9em;
            text-align: right;
        }
        .filter-input {
            padding: 6px 10px;
            border: 1px solid #555;
            border-radius: 5px;
            background: #181820;
            color: #fff;
            font-size: 0.85em;
            width: 110px;
        }
        .filter-input:focus {
            outline: none;
            border-color: #1976d2;
        }
        .filter-input::placeholder {
            color: #888;
        }
        .filter-btn {
            padding: 6px 12px;
            background: #1976d2;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
            font-size: 0.85em;
        }
        .filter-btn:hover {
            background: #1565c0;
        }
        .clear-btn {
            background: #666;
        }
        .clear-btn:hover {
            background: #555;
        }
        
        /* ÌÜµÍ≥Ñ Ïπ¥Îìú */
        .stats-cards {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .stat-card {
            background: #32323e;
            border-radius: 6px;
            padding: 12px 16px;
            text-align: center;
            flex: 1;
            min-width: 120px;
            box-shadow: 0 2px 8px #0002;
        }
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 3px;
        }
        .stat-label {
            color: #bdbdbd;
            font-size: 0.8em;
        }
        
        /* Í≤ΩÍ∏∞ Í≤∞Í≥º ÌÖåÏù¥Î∏î */
        .games-table {
            background: #282838;
            color: #fff;
            border-radius: 10px;
            overflow: hidden;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.85em;
            box-shadow: 0 2px 12px #0002;
            width: 100%;
        }
        .games-table th {
            background: #181820;
            color: #fff;
            font-size: 0.9em;
            padding: 8px 6px;
            border: none;
            letter-spacing: 0.3px;
            border-right: 1px solid #333;
            vertical-align: middle;
            text-align: center;
        }
        .games-table th:last-child {
            border-right: none;
        }
        .games-table td {
            background: #f5f5f5 !important;
            color: #23232b !important;
            font-size: 0.85em;
            padding: 6px 4px;
            border: none;
            border-bottom: 1px solid #e0e0e0;
            vertical-align: middle;
            text-align: center;
        }
        .games-table tr:hover td {
            background: #e8e8e8 !important;
        }
        .games-table .icon-cell {
            background: #eef2f7 !important;
            border-radius: 5px;
            font-size: 0.85em;
            color: #23232b;
            padding: 3px 5px;
            vertical-align: middle;
        }
        .games-table .champion-img {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: 1px solid #888;
            background: #111;
            display: block;
            margin: auto;
        }
        .games-table .user-link a {
            color: #1976d2;
            text-decoration: underline;
            font-weight: bold;
        }
        .games-table .user-link a:hover {
            color: #0d47a1;
        }
        .games-table .result-win {
            color: #1976d2;
        }
        .games-table .result-lose {
            color: #c0392b;
        }
        
        /* ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 20px;
            align-items: center;
        }
        .pagination a, .pagination span {
            padding: 6px 10px;
            border-radius: 5px;
            text-decoration: none;
            color: #90caf9;
            font-weight: bold;
            transition: background 0.2s;
            font-size: 0.9em;
        }
        .pagination a:hover {
            background: #32323e;
        }
        .pagination .current {
            background: #1976d2;
            color: #fff;
        }
        
        /* Î∞òÏùëÌòï */
        @media (max-width: 1200px) {
            .container { max-width: 95%; padding: 14px; }
            .filter-row { flex-direction: column; align-items: stretch; }
            .filter-group { justify-content: space-between; }
        }
        @media (max-width: 768px) {
            .stats-cards { flex-direction: column; }
            .games-table { font-size: 0.8em; }
            .games-table th, .games-table td { padding: 6px 3px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section-title">üìä Ï†ÑÏ≤¥ Í≤ΩÍ∏∞ Í∏∞Î°ù</div>
        
        <!-- ÌïÑÌÑ∞ ÏÑπÏÖò -->
        <div class="filter-section">
            <form method="get" action="{% url 'database' %}">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Ïú†Ï†Ä:</label>
                        <input type="text" name="user" class="filter-input" placeholder="Ïú†Ï†ÄÎ™Ö ÏûÖÎ†•" value="{{ selected_user }}">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Ï±îÌîºÏñ∏:</label>
                        <input type="text" name="champion" class="filter-input" placeholder="ÌïúÍ∏Ä/ÏòÅÎ¨∏ Ï±îÌîºÏñ∏Î™Ö" value="{{ selected_champion }}">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Í≤∞Í≥º:</label>
                        <select name="result" class="filter-input" style="width: 80px;">
                            <option value="">Ï†ÑÏ≤¥</option>
                            <option value="win" {% if selected_result == 'win' %}selected{% endif %}>ÏäπÎ¶¨</option>
                            <option value="lose" {% if selected_result == 'lose' %}selected{% endif %}>Ìå®Î∞∞</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ÎùºÏù∏:</label>
                        <select name="line" class="filter-input" style="width: 80px;">
                            <option value="">Ï†ÑÏ≤¥</option>
                            <option value="TOP" {% if selected_line == 'TOP' %}selected{% endif %}>ÌÉë</option>
                            <option value="JUG" {% if selected_line == 'JUG' %}selected{% endif %}>Ï†ïÍ∏Ä</option>
                            <option value="MID" {% if selected_line == 'MID' %}selected{% endif %}>ÎØ∏Îìú</option>
                            <option value="ADC" {% if selected_line == 'ADC' %}selected{% endif %}>ÏõêÎîú</option>
                            <option value="SUP" {% if selected_line == 'SUP' %}selected{% endif %}>ÏÑúÌèø</option>
                        </select>
                    </div>
                </div>
                <div class="filter-row"style="margin-left: 30px;">
                    <button type="submit" class="filter-btn">
                        <i class="fa-solid fa-filter"></i> ÌïÑÌÑ∞ Ï†ÅÏö©
                    </button>
                    <a href="{% url 'database' %}" class="filter-btn clear-btn">
                        <i class="fa-solid fa-times"></i> ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
                    </a>
                </div>
            </form>
        </div>
        
        <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-number">{{ unique_games_count }}</div>
                <div class="stat-label">Ï¥ù Í≤ΩÍ∏∞ Ïàò</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ total_users }}</div>
                <div class="stat-label">Ï∞∏Ïó¨ Ïú†Ï†Ä Ïàò</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ avg_score|floatformat:1 }}</div>
                <div class="stat-label">ÌèâÍ∑† AI Ï†êÏàò</div>
            </div>
        </div>
        
        <!-- Í≤ΩÍ∏∞Î≥ÑÎ°ú Í∑∏Î£πÌôîÎêú ÌÖåÏù¥Î∏î -->
        {% for game_group in game_groups %}
        <div class="game-group" style="margin-bottom: 32px;">
            <div class="game-header" style="background: #181820; color: #fff; padding: 16px 20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px #0002;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fa-solid fa-gamepad" style="color: #90caf9; font-size: 1.2em;"></i>
                    <span style="font-weight: bold; font-size: 1.1em;">Í≤ΩÍ∏∞ #{{ game_group.game_id }}</span>
                    <span style="color: #bdbdbd; font-size: 0.95em;">({{ game_group.date }})</span>
                    <span style="background: #333; padding: 4px 8px; border-radius: 6px; font-size: 0.85em; color: #90caf9;">{{ game_group.unique_key }}</span>
                </div>

            </div>
            
            <table class="games-table" style="border-radius: 0 0 12px 12px;">
                <thead>
                    <tr>
                        <th style="width: 8%;"><i class="fa-solid fa-trophy"></i><br>Í≤∞Í≥º</th>
                        <th style="width: 8%;"><i class="fa-solid fa-mountain"></i><br>ÎùºÏù∏</th>
                        <th style="width: 12%;"><i class="fa-solid fa-user"></i><br>Ïú†Ï†Ä</th>
                        <th style="width: 10%;"><i class="fa-solid fa-chess-knight"></i><br>Ï±îÌîºÏñ∏</th>
                        <th style="width: 6%;"><i class="fa-solid fa-skull-crossbones"></i><br>ÌÇ¨</th>
                        <th style="width: 6%;"><i class="fa-solid fa-xmark"></i><br>Îç∞Ïä§</th>
                        <th style="width: 6%;"><i class="fa-solid fa-handshake"></i><br>Ïñ¥Ïãú</th>
                        <th style="width: 8%;"><i class="fa-solid fa-chart-line"></i><br>KDA</th>
                        <th style="width: 8%;"><i class="fa-solid fa-bolt"></i><br>Îç∞ÎØ∏ÏßÄ</th>
                        <th style="width: 6%;"><i class="fa-solid fa-leaf"></i><br>CS</th>
                        <th style="width: 8%;"><i class="fa-solid fa-robot"></i><br>AI Ï†êÏàò</th>
                        <th style="width: 8%;"><i class="fa-solid fa-ranking-star"></i><br>ÏàúÏúÑ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for game in game_group.games %}
                    <tr>
                        <td class="icon-cell" style="background: #eef2f7 !important;">
                            {% if game.result == 'win' %}
                                <i class="fa-solid fa-trophy result-win"></i>
                            {% else %}
                                <i class="fa-solid fa-flag result-lose"></i>
                            {% endif %}
                        </td>
                        <td class="icon-cell" style="background: #eef2f7 !important;">
                            {% if game.line == 'TOP' %}ÌÉë
                            {% elif game.line == 'JUG' %}Ï†ïÍ∏Ä
                            {% elif game.line == 'MID' %}ÎØ∏Îìú
                            {% elif game.line == 'ADC' %}ÏõêÎîú
                            {% elif game.line == 'SUP' %}ÏÑúÌèø
                            {% else %}{{ game.line }}{% endif %}
                        </td>
                        <td class="user-link" style="background: #f5f5f5 !important;">
                            <a href="/search/?name={{ game.user.name }}">{{ game.user.name }}</a>
                        </td>
                        <td style="background: #f5f5f5 !important;">
                            <img src="{% static 'img/' %}{{ game.champion_img }}.png" alt="{{ game.champion }}" class="champion-img">
                        </td>
                        <td class="icon-cell" style="background: #eef2f7 !important;">{{ game.kill }}</td>
                        <td class="icon-cell" style="background: #eef2f7 !important;">{{ game.death }}</td>
                        <td class="icon-cell" style="background: #eef2f7 !important;">{{ game.assist }}</td>
                        <td class="icon-cell" style="background: #eef2f7 !important;">{{ game.kda|default:"-" }}</td>
                        <td class="icon-cell" style="background: #eef2f7 !important;">{{ game.damage|default:"-" }}</td>
                        <td class="icon-cell" style="background: #eef2f7 !important;">{{ game.cs|default:"-" }}</td>
                        <td class="icon-cell" style="background: #eef2f7 !important;">{{ game.ai_score|default:"-" }}</td>
                        <td class="icon-cell" style="background: #eef2f7 !important;">{{ game.placement|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% empty %}
        <div style="text-align: center; padding: 40px; color: #888; background: #f5f5f5; border-radius: 12px;">
            <i class="fa-solid fa-info-circle" style="margin-right: 8px;"></i>
            Ï°∞Í±¥Ïóê ÎßûÎäî Í≤ΩÍ∏∞ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.
        </div>
        {% endfor %}
        
        <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
        {% if is_paginated %}
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?{% if selected_user %}user={{ selected_user }}&{% endif %}{% if selected_champion %}champion={{ selected_champion }}&{% endif %}{% if selected_result %}result={{ selected_result }}&{% endif %}{% if selected_line %}line={{ selected_line }}&{% endif %}page={{ page_obj.previous_page_number }}">
                    <i class="fa-solid fa-chevron-left"></i> Ïù¥Ï†Ñ
                </a>
            {% endif %}
            
            {% for num in page_obj.paginator.page_range %}
                {% if num == page_obj.number %}
                    <span class="current">{{ num }}</span>
                {% elif num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
                    <a href="?{% if selected_user %}user={{ selected_user }}&{% endif %}{% if selected_champion %}champion={{ selected_champion }}&{% endif %}{% if selected_result %}result={{ selected_result }}&{% endif %}{% if selected_line %}line={{ selected_line }}&{% endif %}page={{ num }}">{{ num }}</a>
                {% endif %}
            {% endfor %}
            
            {% if page_obj.has_next %}
                <a href="?{% if selected_user %}user={{ selected_user }}&{% endif %}{% if selected_champion %}champion={{ selected_champion }}&{% endif %}{% if selected_result %}result={{ selected_result }}&{% endif %}{% if selected_line %}line={{ selected_line }}&{% endif %}page={{ page_obj.next_page_number }}">
                    Îã§Ïùå <i class="fa-solid fa-chevron-right"></i>
                </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</body>
</html> 