{% load static %}
{% include 'lolapp/header.html' %}
<link rel="stylesheet" href="{% static 'header.css' %}">
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>순위보기</title>
    <style>
        body { background: #23232b; font-family: 'Segoe UI', Arial, sans-serif; color: #e0e0e0; }
        .container { max-width: 950px; margin: 40px auto; background: #23232b; border-radius: 10px; padding: 24px; }
        .tab-menu { display: flex; gap: 8px; margin-bottom: 18px; }
        .tab-btn { padding: 8px 18px; border: none; border-radius: 6px 6px 0 0; background: #e3eaf6; color: #1976d2; font-weight: 500; cursor: pointer; }
        .tab-btn.active { background: #23232b; color: #fff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .section-title { font-size: 1.2em; margin: 24px 0 12px 0; color: #90caf9; }
        table { width: 100%; border-collapse: collapse; margin-top: 12px; }
        th, td { border: 1px solid #444; padding: 8px 4px; text-align: center; }
        th { background: #1976d2; color: #fff; }
        .line-filter { margin-bottom: 12px; }
        .line-btn { padding: 4px 12px; margin-right: 6px; border: none; border-radius: 4px; background: #444; color: #fff; cursor: pointer; }
        .line-btn.active { background: #1976d2; }
        .champion-img { width: 32px; height: 32px; border-radius: 50%; vertical-align: middle; margin-right: 8px; }
        .user-card { display: flex; align-items: center; background: #32323e; border-radius: 8px; padding: 10px 16px; margin-bottom: 8px; }
        .user-rank { width: 32px; font-weight: bold; color: #90caf9; }
        .user-name { flex: 1; font-weight: bold; }
        .user-score { color: #ffd600; font-weight: bold; }
        .vs-table { width: 100%; border-collapse: separate; border-spacing: 0; }
        .vs-table th, .vs-table td { border: none; background: #32323e; padding: 12px 8px; }
        .vs-table th { color: #90caf9; font-size: 1em; }
        .vs-table .win { color: #81c784; font-weight: bold; }
        .vs-table .lose { color: #ef5350; font-weight: bold; }
        .combined-winrate-bar { 
            width: 100%; 
            height: 12px; 
            background-color: #444; 
            border-radius: 6px; 
            margin: 0; 
            overflow: hidden; 
            display: flex; 
        }
        .vs-table tr.bar-row td { padding-top: 6px; padding-bottom: 12px; background: transparent; }
        .dominant-fill { 
            height: 100%; 
            background-color: #4caf50; 
            transition: width 0.3s ease; 
        }
        .subordinate-fill { 
            height: 100%; 
            background-color: #f44336; 
            transition: width 0.3s ease; 
        }
        .kda-score { color: #1976d2; font-weight: bold; margin-left: 8px; }
        .death { color: #ef5350; font-weight: bold; }
        .vs-table .win, .vs-table .win * { color: #81c784 !important; font-weight: bold; }
        .vs-table .lose, .vs-table .lose * { color: #ef5350 !important; font-weight: bold; }
        .kda-score { margin-left: 8px; }
        .vs-table td { font-size: 1.05em; }
        
        /* 승률에 따른 박스 배경색 */
        .vs-table .win {
            background: rgba(25, 118, 210, 0.1) !important;
            border: 2px solid rgba(25, 118, 210, 0.3);
            border-radius: 8px;
        }
        
        .vs-table .lose {
            background: rgba(244, 67, 54, 0.1) !important;
            border: 2px solid rgba(244, 67, 54, 0.3);
            border-radius: 8px;
        }
        
        .winrate-text {
            font-size: 0.8em;
            margin-top: 4px;
            text-align: center;
            font-weight: bold;
        }
        
        .win .winrate-text {
            color: #1976d2;
        }
        
        .lose .winrate-text {
            color: #f44336;
        }
    </style>
    <script>
        function showTab(idx) {
            document.querySelectorAll('.tab-btn').forEach((btn, i) => btn.classList.toggle('active', i===idx));
            document.querySelectorAll('.tab-content').forEach((tab, i) => tab.classList.toggle('active', i===idx));
        }
        function filterLine(tabIdx, line) {
            document.querySelectorAll('.tab-content')[tabIdx].querySelectorAll('.line-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.line === line));
            
            // 라인별 순위표 (탭 인덱스 2)에서만 특별 처리
            if (tabIdx === 2) {
                const allLineStats = document.getElementById('all-line-stats');
                const lineStats = document.getElementById('line-stats');
                
                if (line === 'all') {
                    // 전체 버튼: 전체 정렬된 리스트 표시 (total_score 기준)
                    allLineStats.style.display = '';
                    lineStats.style.display = 'none';
                } else {
                    // 특정 라인 버튼: 라인별 그룹화된 리스트 표시
                    allLineStats.style.display = 'none';
                    lineStats.style.display = '';
                    
                    // 해당 라인의 행만 표시
                    lineStats.querySelectorAll('.line-row').forEach(row => {
                        row.style.display = (row.dataset.line === line) ? '' : 'none';
                    });
                }
            } else {
                // 다른 탭들은 기존 방식대로 처리
                document.querySelectorAll('.tab-content')[tabIdx].querySelectorAll('.line-row').forEach(row => {
                    row.style.display = (line === 'all' || row.dataset.line === line) ? '' : 'none';
                });
            }
        }
        window.onload = function() { showTab(0); };
    </script>
</head>
<body>
    <div class="container">
        <div class="tab-menu">
            <button class="tab-btn" onclick="showTab(0)">순위표🥇🥈🥉</button>
            <button class="tab-btn" onclick="showTab(1)">챔피언별 승률🚩</button>
            <button class="tab-btn" onclick="showTab(2)">라인별 순위표🔥</button>
            <button class="tab-btn" onclick="showTab(3)">user별 상대전적🥊🥊</button>
        </div>
        <!-- 1. 순위표 -->
        <div class="tab-content active">
            <div class="section-title">USER SCORE BOARD</div>
            <table style="margin:0 auto; min-width:700px; background:#222; color:#fff; border-radius:10px; box-shadow:0 2px 16px #0002; border-collapse:separate; border-spacing:0;">
                <tr style="background:#23232b;">
                    <th style="padding:12px 18px; text-align:center;">RANK</th>
                    <th style="padding:12px 18px; text-align:center;">USER</th>
                    <th style="padding:12px 18px; text-align:center;">GAME</th>
                    <th style="padding:12px 18px; text-align:center;">WIN</th>
                    <th style="padding:12px 18px; text-align:center;">LOSE</th>
                    <th style="padding:12px 18px; text-align:center;">WIN RATE</th>
                    <th style="padding:12px 18px; text-align:center;">KDA</th>
                    <th style="padding:12px 18px; text-align:center;">SCORE</th>
                </tr>
                {% for user in user_stats %}
                    <tr
                      {% if forloop.counter == 1 %}
                        style="background:#ffd700; font-weight:bold; color:#000;"
                      {% elif forloop.counter == 2 %}
                        style="background:#c0c0c0; font-weight:bold; color:#000;"
                      {% elif forloop.counter == 3 %}
                        style="background:#cd7f32; font-weight:bold; color:#000;"
                      {% endif %}
                    >
                      <td style="text-align:center; padding:10px 0; min-width:48px;">
                        <span style="display:inline-block; min-width:48px;">
                          {{ forloop.counter }}
                          {% if forloop.counter == 1 %}
                            <span style="margin-left:2px;">🥇</span>
                          {% elif forloop.counter == 2 %}
                            <span style="margin-left:2px;">🥈</span>
                          {% elif forloop.counter == 3 %}
                            <span style="margin-left:2px;">🥉</span>
                          {% elif forloop.last %}
                            <span style="margin-left:2px;">💩</span>
                          {% elif forloop.revcounter == 2 %}
                            <span style="margin-left:2px;">🚽</span>
                          {% endif %}
                        </span>
                      </td>
                      <td style="text-align:center; padding:10px 0;">
                        <a href="/search/?name={{ user.name }}" style="color:inherit; text-decoration:underline;">{{ user.name }}</a>
                      </td>
                      <td style="text-align:center; padding:10px 0;">{{ user.total }}</td>
                      <td style="text-align:center; padding:10px 0;">{{ user.win }}</td>
                      <td style="text-align:center; padding:10px 0;">{{ user.lose }}</td>
                      <td style="text-align:center; padding:10px 0;">{{ user.winrate }}%</td>
                      <td style="text-align:center; padding:10px 0;">{{ user.kda }}</td>
                      <td style="text-align:center; padding:10px 0;">{{ user.score }}</td>
                    </tr>
                {% empty %}
                <tr><td colspan="8" style="padding:12px 0; color:#bbb; text-align:center;">데이터가 없습니다.</td></tr>
                {% endfor %}
            </table>
        </div>
        <!-- 2. 챔피언별 승률 -->
        <div class="tab-content">
            <div class="section-title">챔피언별 승률🚩</div>
            <div class="line-filter">
                <button class="line-btn active" data-line="all" onclick="filterLine(1, 'all')">전체</button>
                <button class="line-btn" data-line="탑" onclick="filterLine(1, '탑')">탑</button>
                <button class="line-btn" data-line="정글" onclick="filterLine(1, '정글')">정글</button>
                <button class="line-btn" data-line="미드" onclick="filterLine(1, '미드')">미드</button>
                <button class="line-btn" data-line="원딜" onclick="filterLine(1, '원딜')">원딜</button>
                <button class="line-btn" data-line="서폿" onclick="filterLine(1, '서폿')">서폿</button>
            </div>
            <table>
                <tr>
                    <th>CHAMPION</th><th>LINE</th><th>GAME</th><th>WIN</th><th>LOSE</th><th>WIN RATE</th><th>KDA</th>
                </tr>
                {% for champ in champion_stats %}
                <tr class="line-row" data-line="{{ champ.line }}">
                    <td><img src="{% static 'img/' %}{{ champ.champion_img }}.png" class="champion-img"></td>
                    <td>{{ champ.line }}</td>
                    <td>{{ champ.games }}</td>
                    <td>{{ champ.win }}</td>
                    <td>{{ champ.lose }}</td>
                    <td>{{ champ.winrate }}%</td>
                    <td>{{ champ.kda }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="7">데이터가 없습니다.</td></tr>
                {% endfor %}
            </table>
        </div>
        <!-- 3. 라인별 순위표 -->
        <div class="tab-content">
            <div class="section-title">라인별 순위표🥇🥈🥉</div>
            <div class="line-filter">
                <button class="line-btn active" data-line="all" onclick="filterLine(2, 'all')">전체</button>
                <button class="line-btn" data-line="탑" onclick="filterLine(2, '탑')">탑</button>
                <button class="line-btn" data-line="정글" onclick="filterLine(2, '정글')">정글</button>
                <button class="line-btn" data-line="미드" onclick="filterLine(2, '미드')">미드</button>
                <button class="line-btn" data-line="원딜" onclick="filterLine(2, '원딜')">원딜</button>
                <button class="line-btn" data-line="서폿" onclick="filterLine(2, '서폿')">서폿</button>
            </div>
            <table>
                <tr>
                    <th>RANK</th><th>USER</th><th>LINE</th><th>GAME</th><th>WIN</th><th>LOSE</th><th>WIN RATE</th><th>KDA</th><th>SCORE</th>
                </tr>
                <!-- 전체 정렬된 리스트 (total_score 기준) -->
                <tbody id="all-line-stats">
                    {% for user in all_line_user_stats %}
                    <tr class="line-row" data-line="{{ user.line }}">
                        <td>{{ forloop.counter }}</td>
                        <td>{{ user.name }}</td>
                        <td>{{ user.line }}</td>
                        <td>{{ user.total }}</td>
                        <td>{{ user.win }}</td>
                        <td>{{ user.lose }}</td>
                        <td>{{ user.winrate }}%</td>
                        <td>{{ user.kda }}</td>
                        <td>{{ user.score }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="9">데이터가 없습니다.</td></tr>
                    {% endfor %}
                </tbody>
                <!-- 라인별 정렬된 리스트 (라인별 그룹화) -->
                <tbody id="line-stats" style="display: none;">
                    {% for user in line_user_stats %}
                    <tr class="line-row" data-line="{{ user.line }}">
                        <td>{{ forloop.counter }}</td>
                        <td>{{ user.name }}</td>
                        <td>{{ user.line }}</td>
                        <td>{{ user.total }}</td>
                        <td>{{ user.win }}</td>
                        <td>{{ user.lose }}</td>
                        <td>{{ user.winrate }}%</td>
                        <td>{{ user.kda }}</td>
                        <td>{{ user.score }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="9">데이터가 없습니다.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- 4. user별 상대전적 -->
        <div class="tab-content">
            <div class="section-title">유저별 상대전적🥊</div>
            <div class="line-filter">
                <button class="line-btn active" data-line="all" onclick="filterLine(3, 'all')">전체</button>
                <button class="line-btn" data-line="탑" onclick="filterLine(3, '탑')">탑</button>
                <button class="line-btn" data-line="정글" onclick="filterLine(3, '정글')">정글</button>
                <button class="line-btn" data-line="미드" onclick="filterLine(3, '미드')">미드</button>
                <button class="line-btn" data-line="원딜" onclick="filterLine(3, '원딜')">원딜</button>
                <button class="line-btn" data-line="서폿" onclick="filterLine(3, '서폿')">서폿</button>
            </div>
            <table class="vs-table">
                <tr>
                    <th>우세😀</th><th>열세😭</th>
                </tr>
                {% for line, vs_list in vs_stats.items %}
                    {% for pair in vs_list %}
                        <tr class="line-row" data-line="{{ line }}">
                            <td>
                                <div style="font-size:1.1em;">{{ pair.0.name }}</div>
                                <div style="font-size:0.9em; color:#888;">{{ pair.0.total }}전 {{ pair.0.wins }}승{{ pair.0.losses }}패</div>
                                <div>{{ pair.0.k_sum }} / {{ pair.0.d_sum }} / {{ pair.0.a_sum }}</div>
                                <div class="kda-score">KDA: {{ pair.0.kda }}</div>
                                <div class="winrate-text" style="color: #4caf50;">승률 {{ pair.0.winrate }}%</div>
                            </td>
                            <td>
                                <div style="font-size:1.1em;">{{ pair.1.name }}</div>
                                <div style="font-size:0.9em; color:#888;">{{ pair.1.total }}전 {{ pair.1.wins }}승{{ pair.1.losses }}패</div>
                                <div>{{ pair.1.k_sum }} / {{ pair.1.d_sum }} / {{ pair.1.a_sum }}</div>
                                <div class="kda-score">KDA: {{ pair.1.kda }}</div>
                                <div class="winrate-text" style="color: #f44336;">승률 {{ pair.1.winrate }}%</div>
                            </td>
                        </tr>
                        <tr class="line-row bar-row" data-line="{{ line }}">
                            <td colspan="2">
                                <div class="combined-winrate-bar">
                                    <div class="dominant-fill" style="width: {{ pair.0.winrate }}%; background-color: #4caf50;"></div>
                                    <div class="subordinate-fill" style="width: {{ pair.1.winrate }}%; background-color: #f44336;"></div>
                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="2" style="text-align:center; color:#888; padding:20px;">
                                해당 라인에서 상대로 만난 유저가 없습니다.
                            </td>
                        </tr>
                    {% endfor %}
                {% endfor %}
            </table>
        </div>
    </div>
</body>
</html> 