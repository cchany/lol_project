{% load static %}
{% include 'lolapp/header.html' %}
<link rel="stylesheet" href="{% static 'header.css' %}">
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì „ì ê²€ìƒ‰</title>
    <style>
        body { background: #23232b; font-family: 'Segoe UI', Arial, sans-serif; color: #e0e0e0; }
        .container { max-width: 950px; margin: 40px auto; background: #23232b; border-radius: 10px; padding: 24px; }
        .search-bar { display: flex; gap: 8px; margin-bottom: 24px; }
        .search-bar input { flex: 1; padding: 8px; border: 1px solid #444; border-radius: 4px; background: #181820; color: #fff; }
        .search-bar button { padding: 8px 16px; background: #1976d2; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        .section-title { font-size: 1.2em; margin: 32px 0 12px 0; color: #90caf9; }
        .champion-list { display: flex; flex-direction: column; gap: 8px; }
        .champion-card { display: flex; align-items: center; background: #32323e; border-radius: 8px; padding: 12px 20px; }
        .champion-card img { width: 48px; height: 48px; border-radius: 50%; margin-right: 16px; }
        .champion-info { flex: 1; }
        .champion-name { font-weight: bold; font-size: 1.1em; }
        .champion-cs { font-size: 0.95em; color: #bdbdbd; }
        .champion-kda { color: #4caf50; font-weight: bold; margin-left: 12px; }
        .champion-score { color: #26c6da; margin-left: 12px; }
        .champion-winrate { margin-left: 12px; font-weight: bold; }
        .champion-winrate.red { color: #ef5350; }
        .champion-winrate.green { color: #81c784; }
        .champion-games { margin-left: 12px; color: #bdbdbd; }
        .team-list { background: #23232b; border-radius: 8px; padding: 12px 20px; margin-bottom: 24px; }
        .team-user { display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid #333; }
        .team-user:last-child { border-bottom: none; }
        .team-user img { width: 36px; height: 36px; border-radius: 50%; margin-right: 12px; }
        .team-user-info { flex: 1; }
        .team-user-name { font-weight: bold; }
        .team-user-level { font-size: 0.95em; color: #bdbdbd; margin-left: 8px; }
        .team-user-record { margin-right: 24px; }
        .team-user-winrate { font-weight: bold; min-width: 48px; text-align: right; }
        .team-user-winrate.red { color: #ef5350; }
        .team-user-winrate.green { color: #81c784; }
        .game-list { display: flex; flex-direction: column; gap: 16px; }
        .game-card { background: #26324a; border-radius: 8px; padding: 16px 20px; display: flex; align-items: center; border-left: 6px solid #1976d2; }
        .game-card.lose { border-left: 6px solid #ef5350; }
        .game-champion { display: flex; align-items: center; margin-right: 20px; }
        .game-champion img { width: 40px; height: 40px; border-radius: 50%; margin-right: 8px; }
        .game-info { flex: 1; }
        .game-kda { font-size: 1.1em; font-weight: bold; }
        .game-kda .death { color: #ef5350; }
        .game-kda .score { color: #4caf50; margin-left: 8px; }
        .game-detail { font-size: 0.95em; color: #bdbdbd; margin-top: 2px; }
        .game-vs { min-width: 80px; text-align: right; font-size: 1em; color: #bdbdbd; }
    </style>
</head>
<body>
    <div class="container">
        <form class="search-bar" method="get" action="{% url 'search' %}">
            <input type="text" name="name" placeholder="ì†Œí™˜ì‚¬ëª…ì´ë‚˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" value="{{ query }}">
            <button type="submit">ê²€ìƒ‰</button>
        </form>

        {% if user %}
        <!-- ìµœê·¼ ê²Œì„ ìš”ì•½ ë°•ìŠ¤ (ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼) -->
        <div class="recent-summary" style="background:#23232b; border-radius:16px; padding:24px 32px; margin-bottom:32px; display:flex; gap:32px; align-items:center; box-shadow:0 2px 8px #0002;">
                            <!-- ì™¼ìª½: ìŠ¹ë¥ /ì „ì /KDA/total_score -->
            <div style="min-width:180px; text-align:center;">
                <div style="width:90px; height:90px; margin:0 auto 8px auto; position:relative;">
                    <!-- ë„ë„›ì°¨íŠ¸: ìŠ¹/íŒ¨ ë¹„ìœ¨ -->
                    <svg width="90" height="90" viewBox="0 0 36 36" style="transform:rotate(-90deg);">
                        <!-- íŒ¨ë°°(ë¹¨ê°•) ì „ì²´ ì› -->
                        <circle cx="18" cy="18" r="16" fill="none" stroke="#c62828" stroke-width="4" />
                        <!-- ìŠ¹ë¦¬(íŒŒë‘) ì›í˜¸ -->
                        <circle cx="18" cy="18" r="16" fill="none" stroke="#1976d2" stroke-width="4" stroke-dasharray="{{ win_percent }},100" stroke-dashoffset="0" />
                    </svg>
                    <span style="position:absolute; width:100%; top:32px; left:0; text-align:center; font-size:1.3em; color:#ef5350;">{{ win_percent }}%</span>
                </div>
                <div style="font-size:1.1em; margin-bottom:2px;">{{ stats.total }}ì „ {{ stats.win }}ìŠ¹ {{ stats.lose }}íŒ¨</div>
                <div style="font-size:1.3em; font-weight:bold; margin-bottom:2px;">
                    <span style="color:#e0e0e0;">{{ stats.kill_avg }}</span> /
                    <span style="color:#ef5350;">{{ stats.death_avg }}</span> /
                    <span style="color:#81c784;">{{ stats.assist_avg }}</span>
                    <span style="font-size:1.5em; color:#fff; margin-left:8px;">{{ stats.kda }}</span>
                </div>
                <div style="color:#ffd600; font-size:1em;">Total {{ final_score|floatformat:1 }}</div>
            </div>
            <!-- ê°€ìš´ë°: í”Œë ˆì´í•œ ì±”í”¼ì–¸(ìµœê·¼ 20ê²Œì„) -->
            <div style="flex:1; min-width:220px;">
                <div class="section-title" style="margin:0 0 8px 0;">í”Œë ˆì´í•œ ì±”í”¼ì–¸ğŸ‘‘</div>
                <div style="display:flex; flex-direction:column; gap:8px;">
                    {% for champ in champion_stats|slice:':3' %}
                    <div style="display:flex; align-items:center; gap:8px;">
                        <img src="{% static 'img/' %}{{ champ.champion_img }}.png" style="width:32px; height:32px; border-radius:50%;">
                        <span style="font-weight:bold; color:{% if champ.winrate >= 60 %}#ef5350{% elif champ.winrate == 100 %}#81c784{% else %}#ffd600{% endif %};">{{ champ.winrate }}%</span>
                        <span style="color:#bdbdbd;">({{ champ.win }}ìŠ¹ / {{ champ.lose }}íŒ¨)</span>
                        <span style="color:#4caf50; font-weight:bold; margin-left:8px;">{{ champ.kda }} í‰ì </span>
                    </div>
                    {% empty %}
                    <div style="color:#bdbdbd;">í”Œë ˆì´í•œ ì±”í”¼ì–¸ ë°ì´í„° ì—†ìŒ</div>
                    {% endfor %}
                </div>
            </div>
            <!-- ì˜¤ë¥¸ìª½: ì„ í˜¸ í¬ì§€ì…˜ (ë¼ì¸ë³„ bar) -->
            <div style="min-width:180px; text-align:center;">
                <div class="section-title" style="margin:0 0 8px 0;">ì„ í˜¸ í¬ì§€ì…˜</div>
                <div style="display:flex; gap:8px; align-items:end; height:60px; justify-content:center;">
                    {% for bar in line_bars %}
                    <div style="width:18px; height:{{ bar.height }}px; background:{{ bar.color }}; border-radius:6px 6px 0 0;"></div>
                    {% endfor %}
                </div>
                <div style="display:flex; gap:8px; justify-content:center; margin-top:4px; font-size:1.2em; color:#bdbdbd;">
                    <span>ğŸ›¡ï¸</span><span>ğŸŒ¿</span><span>âš”ï¸</span><span>ğŸ¹</span><span>âœ¨</span>
                </div>
            </div>
        </div>


        <!-- 2,3ë²ˆ: í•˜ë‹¨ 2ë‹¨(ì¢Œ:íŒ€ì›, ìš°:ê²½ê¸°ê¸°ë¡) -->
        <div style="display:flex; gap:12px; align-items:flex-start;">
            <!-- 2ë²ˆ: ê°™ì€ íŒ€ ì†Œí™˜ì‚¬ (ì™¼ìª½) -->
            <div style="flex:0 0 320px; min-width:220px; background:#23232b; border-radius:32px; padding:28px 18px 28px 18px;">
                <div class="section-title">ê°™ì€ íŒ€ìœ¼ë¡œ ê²Œì„í•œ ì†Œí™˜ì‚¬ë“¤ğŸ§‘ğŸ»â€â¤ï¸â€ğŸ’‹â€ğŸ§‘ğŸ»</div>
                <div class="team-list" style="background:none; padding:0;">
                    {% for team in team_users %}
                    <div class="team-user">
                        <img src="{% static 'img/logo.png' %}">
                        <div class="team-user-info">
                            <span class="team-user-name">{{ team.name }}</span>
                        </div>
                        <div class="team-user-record">{{ team.win }}ìŠ¹ / {{ team.lose }}íŒ¨<br>{{ team.games }} ê²Œì„</div>
                        <div class="team-user-winrate {% if team.winrate >= 60 %}green{% elif team.winrate <= 40 %}red{% endif %}">{{ team.winrate }}%</div>
                    </div>
                    {% empty %}
                    <div style="color:#bdbdbd; padding:16px;">ê°™ì´ í•œ íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                    {% endfor %}
                </div>
            </div>
            <!-- 3ë²ˆ: ê²Œì„ ê¸°ë¡ (ì˜¤ë¥¸ìª½) -->
            <div style="flex:1; background:#23232b; border-radius:48px; padding:32px 32px 32px 32px; min-width:320px;">
                
                <!-- ì ìˆ˜ ë³€ë™ ê·¸ë˜í”„ -->
                {% if score_graph_data %}
                <div style="background:#1a1a22; border-radius:12px; padding:16px; margin-bottom:20px;">
                    <div style="font-size:0.9em; color:#bdbdbd; margin-bottom:8px;">ì ìˆ˜ ë³€ë™ ğŸ“ˆ</div>
                    <div style="position:relative; height:60px; width:100%;">
                        <svg width="100%" height="60" viewBox="0 0 {{ graph_width }} 60" style="overflow:visible;">
                            <!-- ê·¸ë¦¬ë“œ ë¼ì¸ (ë™ì  ë²”ìœ„) -->
                            <line x1="0" y1="30" x2="{{ graph_width }}" y2="30" stroke="#444" stroke-width="1" stroke-dasharray="3,3"/>
                            <line x1="0" y1="15" x2="{{ graph_width }}" y2="15" stroke="#333" stroke-width="1" stroke-dasharray="2,2"/>
                            <line x1="0" y1="45" x2="{{ graph_width }}" y2="45" stroke="#333" stroke-width="1" stroke-dasharray="2,2"/>
                            <line x1="0" y1="0" x2="{{ graph_width }}" y2="0" stroke="#333" stroke-width="1" stroke-dasharray="2,2"/>
                            <line x1="0" y1="60" x2="{{ graph_width }}" y2="60" stroke="#333" stroke-width="1" stroke-dasharray="2,2"/>
                            
                            <!-- ì ìˆ˜ ì„  ê·¸ë˜í”„ -->
                            {% if score_graph_data|length > 1 %}
                            <polyline 
                                points="{% for data in score_graph_data %}{{ data.x }},{{ data.y }}{% if not forloop.last %},{% endif %}{% endfor %}"
                                fill="none" 
                                stroke="{% if final_score > 100 %}#4caf50{% else %}#ef5350{% endif %}" 
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            />
                            {% endif %}
                            
                            <!-- ì ìˆ˜ í¬ì¸íŠ¸ -->
                            {% for data in score_graph_data %}
                            {% if data.result != 'start' %}
                            <circle 
                                cx="{{ data.x }}" 
                                cy="{{ data.y }}" 
                                r="3" 
                                fill="{% if data.result == 'win' %}#1976d2{% else %}#c62828{% endif %}"
                                stroke="#fff"
                                stroke-width="1"
                            />
                            {% else %}
                            <circle 
                                cx="{{ data.x }}" 
                                cy="{{ data.y }}" 
                                r="2" 
                                fill="#bdbdbd"
                                stroke="#fff"
                                stroke-width="1"
                            />
                            {% endif %}
                            {% endfor %}
                        </svg>
                        <!-- ì ìˆ˜ ë²”ë¡€ -->
                        <div style="position:absolute; top:0; right:0; font-size:0.8em; color:#bdbdbd;">
                            <span style="color:{% if final_score >= 100 %}#4caf50{% else %}#ef5350{% endif %}; font-weight:bold;">
                                {% if final_score >= 100 %}â–²{% else %}â–¼{% endif %}
                            </span> {{ final_score|floatformat:1 }}
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="section-title">ê²Œì„ ê¸°ë¡ğŸ®</div>

                <div class="game-list">
                    {% for game in game_records %}
                    <div class="game-card {% if game.result == 'lose' %}lose{% else %}win{% endif %}" style="background:{% if game.result == 'lose' %}#c62828{% else %}#1976d2{% endif %}; color:#fff; border:none;">
                        <div class="game-champion">
                            <img src="{% static 'img/' %}{{ game.champion_img }}.png">
                            <span>{{ game.champion }}</span>
                        </div>
                        <div class="game-info" style="text-align:center;">
                            <div class="game-kda" style="justify-content:center; display:flex; align-items:center; gap:4px; font-size:1.1em; font-weight:bold;">
                                <span>{{ game.kill }}</span> / <span class="death">{{ game.death }}</span> / <span>{{ game.assist }}</span> <span class="score">{{ game.kda }} í‰ì </span>
                                {% if game.rank_title %}
                                <span style="font-size:0.8em; color:#fff; margin-left:4px; font-weight:bold;">{{ game.rank_title }}</span>
                                {% endif %}
                            </div>
                            <div style="display:flex; justify-content:center; gap:12px; margin-top:4px; font-size:0.9em; color:#bdbdbd;">
                                <span>KP: {{ game.kp|default:"-" }}%</span>
                                <span>Score: {{ game.game_score|default:"-" }}</span>
                                <span style="color:{% if game.rank_score > 0 %}#4caf50{% elif game.rank_score < 0 %}#bdbdbd{% else %}#bdbdbd{% endif %};">
                                    Rank: {{ game.rank_score|default:"-" }}{% if game.rank_score > 0 %}+{% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="game-vs">ìƒëŒ€: {{ game.opponent }}</div>
                    </div>
                    {% empty %}
                    <div style="color:#bdbdbd; padding:16px;">ê²Œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.ğŸ˜’</div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% else %}
        <div style="color:#bdbdbd; padding:32px; text-align:center;">ì†Œí™˜ì‚¬ëª…ì´ë‚˜ ì´ë¦„ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.ğŸ”¥</div>
        {% endif %}
    </div>
</body>
</html> 